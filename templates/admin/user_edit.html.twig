{% extends 'base.html.twig' %}
{% block title %}Éditer l’utilisateur #{{ user.id }} — Admin{% endblock %}

{% block body %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">Éditer l’utilisateur #{{ user.id }}</h1>
    <a class="btn btn-sm btn-outline-secondary"
       href="{{ path('admin_users', {
         q: app.request.query.get('q'),
         role: app.request.query.get('role'),
         sort: app.request.query.get('sort'),
         dir: app.request.query.get('dir')
       }) }}">← Retour</a>
  </div>

  <div class="card">
    <div class="card-body">
      <form method="post" action="{{ path('admin_user_edit', app.request.query.all|merge({id: user.id})) }}">
        <input type="hidden" name="_token" value="{{ csrf_token('edit_user_' ~ user.id) }}">

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label" for="name">Nom</label>
            <input class="form-control" type="text" id="name" name="name" value="{{ user.name ?? '' }}" placeholder="Nom à afficher">
          </div>

          <div class="col-md-6">
            <label class="form-label">Email</label>
              <label>
                  <input class="form-control" type="email" value="{{ user.email }}" disabled>
              </label>
          </div>

          <div class="col-12">
            <label class="form-label d-block">Rôles</label>
            {% set hasAdmin = user.roles is defined and 'ROLE_ADMIN' in user.roles %}
            {% set hasPrep  = user.roles is defined and 'ROLE_PREPARATEUR' in user.roles %}
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="role_admin" name="roles[]" value="ROLE_ADMIN" {{ hasAdmin ? 'checked' }}>
              <label class="form-check-label" for="role_admin">ROLE_ADMIN</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="role_preparateur" name="roles[]" value="ROLE_PREPARATEUR" {{ hasPrep ? 'checked' }}>
              <label class="form-check-label" for="role_preparateur">ROLE_PREPARATEUR (Préparateur)</label>
            </div>
            <div class="form-text">
              ROLE_USER est toujours présent par défaut.
            </div>
          </div>
        </div>

        <div class="mt-4 d-flex gap-2">
          <button type="submit" class="btn btn-primary">Enregistrer</button>
          <a class="btn btn-outline-secondary"
             href="{{ path('admin_users', {
               q: app.request.query.get('q'),
               role: app.request.query.get('role'),
               sort: app.request.query.get('sort'),
               dir: app.request.query.get('dir')
             }) }}">Annuler</a>
        </div>
      </form>
    </div>
  </div>
{% endblock %}

